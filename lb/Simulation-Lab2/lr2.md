# Комп'ютерні системи імітаційного моделювання  
СПм-24-1, Мальнєв Данило Максимович  
Лабораторна робота №2. Редагування імітаційних моделей у середовищі NetLogo  

**Варіант:** Autumn  
**Модель у середовищі NetLogo:** Autumn  

---

## Внесені зміни у вихідну логіку моделі, за варіантом

Згідно варіанту завдання, у модель **Autumn** додано **добові цикли зміни інтенсивності сонячного світла**, які також **впливають на температуру середовища**.  
Тривалість модельної «доби» задається **внутрішнім параметром** і використовується для циклічного (періодичного) оновлення стану моделі по часу.

### 1) Додані внутрішні параметри (змінні)

У модель введено параметри, що відповідають за цикл «день/ніч» і реакцію температури:

```netlogo
day-length
base-temperature
base-sun-intensity
temp-lag
```
day-length — кількість тактів модельного часу, що становить одну добу.

base-sun-intensity — базова інтенсивність сонця (масштаб для відсотків/яскравості).

base-temperature — базова температура, від якої відштовхується добова динаміка.

temp-lag — коефіцієнт “запізнення/інерції” температури (плавність зміни).

Параметр day-length використовується для обчислення фази доби на основі ticks, тобто значення часу моделі.

2) Реалізовано окрему процедуру добового циклу
Замість сталої інтенсивності сонця та сталої температури реалізовано окрему процедуру оновлення цих значень на кожному такті:
```
to update-daily-cycle
  let phase ((ticks mod day-length) / day-length)
  let raw (sin (phase * 360 - 90))
  let daylight max list 0 ((raw + 1) / 2)

  set sun-intensity base-sun-intensity * daylight
  set sun-intensity clip sun-intensity

  let target-temp (base-temperature + (sun-intensity / 8))
  set temperature temperature + temp-lag * (target-temp - temperature)
end
```
Як працює цикл «день/ніч»
phase дає значення 0..1 в межах однієї доби.

sin(...) формує плавний профіль освітленості (без стрибків).

daylight обмежується від 0 до 1 (вночі 0, вдень до 1).

sun-intensity отримує значення в діапазоні 0..base-sun-intensity.

3) Найголовніше: саме тут змінюється температура
Вплив сонця на температуру зроблено двома кроками:


обчислюється цільова температура:
```
let target-temp (base-temperature + (sun-intensity / 8))
```
фактична температура плавно наближається до цільової з інерцією:

```set temperature temperature + temp-lag * (target-temp - temperature)```
Важливо: число 8 у виразі (sun-intensity / 8) — це коефіцієнт масштабування впливу сонця на температуру (амплітуда зміни), а не порогова температура і не умова холодового стресу.
Тобто / 8 визначає “наскільки сильно” світло підіймає температуру, а не “коли” вмикається стрес.

Таким чином:

вночі, коли sun-intensity → 0, температура знижується до рівня base-temperature;

вдень температура підвищується пропорційно sun-intensity;

temp-lag визначає плавність (теплова інерція).

4) Де саме це викликається
Процедура update-daily-cycle викликається на кожному такті модельного часу у процедурі go (перед оновленням візуалізації сонця), тобто температура та інтенсивність світла постійно оновлюються під час симуляції
```
to go
  ;; Lab2: оновлюємо сонце і температуру кожен тик
  update-daily-cycle

  ;; Lab2 (own): оновлюємо стан "cold stress" кожен тик
  update-cold-stress

  make-wind-blow
  make-rain-fall
  move-water
  ask suns [ show-intensity ]

  tick
end
```

Внесені зміни у вихідну логіку моделі, на власний розсуд
На власний розсуд у модель додано механізм холодового стресу листя, який не руйнує логіку моделі (листя як і раніше росте/накопичує речовини/опадає), але додає реалістичну реакцію на низькі температури.

1) Додані внутрішні параметри і лічильники
Уведено такі параметри:
```
cold-threshold
cold-stress-duration
cold-detach-penalty
cold-photosynthesis-penalty
cold-stress-count 
```
Також кожному листку додано змінну стану:

cold-stress-ticks
```
leaves-own [
  cold-stress-ticks
]
```
2) Порогове значення: де саме видно “10 °C”
Холодовий стрес активується тільки за умовою:
```
if temperature < cold-threshold [ ... ]
При цьому порогове значення задано як:

cold-threshold = 10 °C (ініціалізується у setup як внутрішній параметр).
```

Отже:

при temperature < 10 — механізм стресу активний;

при temperature >= 10 — стрес не запускається.

Це прямо усуває можливу плутанину з виразом (sun-intensity / 8):
8 там — масштаб, а cold-threshold — порог.

3) Логіка холодового стресу (що саме змінюється)
Якщо температура падає нижче cold-threshold, лист входить у стан холодового стресу на фіксований час cold-stress-duration. Під час цього стану:
```
if temperature < cold-threshold and cold-stress-ticks = 0 [
  set cold-stress-ticks cold-stress-duration
]

if cold-stress-ticks > 0 [
  set cold-stress-ticks cold-stress-ticks - 1

  set attachedness attachedness - cold-detach-penalty

  let conv min list 1.5 (min list sugar-level water-level)
  set sugar-level sugar-level - conv
  set water-level water-level - conv
  set anthocyanin anthocyanin + conv
]
```

погіршується “утримання” листка: зменшується attachedness, що підвищує ймовірність опадання;

посилюється почервоніння: частина sugar-level і water-level переходить у anthocyanin;

пригнічується фотосинтез у adjust-sugar через коефіцієнт cold-photosynthesis-penalty;

обмежується поглинання води при низьких температурах (фізіологічне пригнічення процесів у холоді).

4) Лічильник cold-stress-count (що це і навіщо)
```
set cold-stress-count 0

ask attached-leaves [
  if cold-stress-ticks > 0 [
    set cold-stress-count cold-stress-count + 1
  ]
]
```
Окремо реалізовано cold-stress-count — це кількість листків, що перебувають у стані холодового стресу на поточному такті.
Лічильник використовується як наочний показник для експерименту і дозволяє порівнювати сценарії зі зміною day-length.

Запропоновані зміни не порушують загальну логіку моделі, а додають додатковий реалістичний механізм реагування листя на низькі температури.

Обчислювальні експерименти
1. Вплив тривалості доби на інтенсивність холодового стресу листя
Мета експерименту — дослідити, як зміна параметра day-length 
```
set day-length 100
;; або
set day-length 200
;; або
set day-length 400
```
(тривалість модельної доби) впливає на:

коливання sun-intensity та temperature;

кількість листків у стані холодового стресу (cold-stress-count);

загальну динаміку опадання листя.

Хід експерименту
Параметр day-length послідовно встановлювався у значення:

100 тактів;

200 тактів;

400 тактів.

Інші параметри моделі залишалися незмінними. Для кожного значення модель запускалася на однакову кількість тактів модельного часу.

Відстежувані показники
У ході експерименту відстежувалися:

значення температури (temperature);

інтенсивність сонячного світла (sun-intensity);

кількість листків у холодовому стресі (cold-stress-count);

динаміка опадання (зміна кількості leaves/dead-leaves).

Висновок
Результати показали, що при меншій тривалості доби (day-length = 100) холодні фази виникають частіше, що збільшує cold-stress-count та прискорює опадання листя.
При збільшенні тривалості доби (day-length = 400) температурні коливання стають плавнішими, а холодовий стрес проявляється рідше.
```
;; періодичність добового циклу визначається day-length
let phase ((ticks mod day-length) / day-length)

;; формування освітленості протягом доби
let raw (sin (phase * 360 - 90))
let daylight max list 0 ((raw + 1) / 2)

set sun-intensity base-sun-intensity * daylight

;; температура змінюється плавно з інерцією
let target-temp (base-temperature + (sun-intensity / 8))
set temperature temperature + temp-lag * (target-temp - temperature)
```

Скріншот моделі в процесі симуляції
![Скріншот моделі](https://github.com/matthewbp-nure/simulation-lab1/blob/main/lb/Simulation-Lab2/process.png)
